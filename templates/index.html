<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Library Support AI</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/dashboard.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-brain"></i>
                <h1>Library Support AI</h1>
            </div>
            
            <div class="model-selector">
                <div class="model-group">
                    <span class="model-label">Chat Model:</span>
                    <select id="chatModelSelect">
                        <option value="">Loading models...</option>
                    </select>
                </div>
                <div class="model-group">
                    <span class="model-label">Embedding Model:</span>
                    <select id="embeddingModelSelect">
                        <option value="">Loading models...</option>
                    </select>
                </div>
                <div class="model-group">
                    <span class="model-label"></span>
                    <button id="applyBtn" class="btn-apply" disabled>
                        <i class="fas fa-sync-alt"></i> Apply Model Changes
                    </button>
                </div>
                <div id="statusMessage" class="status-message"></div>
            </div>
            
            <div class="status-indicator">
                <span class="model-tag" id="currentModelTag">Ollama: Loading...</span>
            </div>
        </header>

        <section class="welcome-section">
            <h2>Welcome!</h2>
            <p>System Reliability Dashboard for Library Research AI</p>
            <p><small>Change AI models using the selector above. This will update all system components.</small></p>
        </section>

        <!-- Resource Indicators -->
        <div class="resource-indicators">
            <div class="resource-card cpu">
                <div class="resource-value" id="cpuPercent">0%</div>
                <div class="resource-label">CPU Usage</div>
            </div>
            <div class="resource-card memory">
                <div class="resource-value" id="memoryPercent">0%</div>
                <div class="resource-label">Memory Used</div>
            </div>
            <div class="resource-card disk">
                <div class="resource-value" id="diskPercent">0%</div>
                <div class="resource-label">Disk Usage</div>
            </div>
            <div class="resource-card tasks">
                <div class="resource-value" id="activeTasksCount">0</div>
                <div class="resource-label">Active Tasks</div>
            </div>
        </div>

        <div class="grid-menu">
            <a href="/chat" class="menu-card">
                <i class="fas fa-comments"></i>
                <h3>AI Chat Interface</h3>
                <p>Query your uploaded research papers using natural language.</p>
                <span style="color: var(--primary); font-weight: bold;">Open Chat →</span>
            </a>

            <a href="/files" class="menu-card">
                <i class="fas fa-file-invoice"></i>
                <h3>Document Manager</h3>
                <p>Upload, delete, and process PDF files for the vector store.</p>
                <span style="color: var(--primary); font-weight: bold;">Manage Files →</span>
            </a>

            <a href="/models" class="menu-card">
                <i class="fas fa-cog"></i>
                <h3>Model Management</h3>
                <p>Install, configure, and manage AI models.</p>
                <span style="color: var(--primary); font-weight: bold;">Manage Models →</span>
            </a>
        </div>

        <!-- Popular Embedding Models Section -->
        <div class="popular-models">
            <div class="status-header">
                <i class="fas fa-star"></i> Popular Embedding Models for Ollama
            </div>
            <p style="color: var(--secondary); margin-bottom: 20px;">
                Select from these recommended models. Click "Use This Model" to apply.
            </p>
            
            <div class="models-grid" id="popularModelsGrid">
                <!-- Models will be populated by JavaScript -->
            </div>
            
            <div class="quick-actions">
                <button id="installMissingBtn" class="btn-quick primary">
                    <i class="fas fa-download"></i> Install Missing Models
                </button>
                <button id="refreshModelsListBtn" class="btn-quick">
                    <i class="fas fa-redo"></i> Refresh Available Models
                </button>
                <button id="showGuideBtn" class="btn-quick tooltip">
                    <i class="fas fa-question-circle"></i> What are Embedding Models?
                    <span class="tooltiptext">
                        <strong>Embedding Models</strong> convert text to numbers for semantic search.<br><br>
                        <strong>Purpose:</strong> Find relevant information in your PDFs<br>
                        <strong>Why it matters:</strong> Better embeddings = better search results<br>
                        <strong>Size matters:</strong> Larger models = more accurate but slower<br>
                        <strong>Recommendation:</strong> Use nomic-embed-text for most cases
                    </span>
                </button>
            </div>
        </div>

        <!-- AI Engine Status -->
        <div class="model-status-box">
            <div class="status-header">
                <i class="fas fa-microchip"></i> AI Engine Status
            </div>
            
            <div class="status-item">
                <span class="status-label">Active Chat Model:</span>
                <span class="status-value" id="currentChatModel">Loading...</span>
            </div>
            
            <div class="status-item">
                <span class="status-label">Active Embedding Model:</span>
                <span class="status-value" id="currentEmbeddingModel">Loading...</span>
            </div>
            
            <div class="status-item">
                <span class="status-label">Architecture:</span>
                <span class="status-value">RAG (Retrieval-Augmented Generation)</span>
            </div>
            
            <div class="status-item">
                <span class="status-label">Provider:</span>
                <span class="status-value">Local Ollama Instance</span>
            </div>
            
            <div class="status-item">
                <span class="status-label">Vector Store:</span>
                <span class="status-value" id="vectorStoreStatus">Checking...</span>
            </div>
            
            <div class="status-item">
                <span class="status-label">Ollama Connection:</span>
                <span class="status-value" id="ollamaStatus">Checking...</span>
            </div>
            
            <div class="test-links">
                <a href="/health" class="btn-test"><i class="fas fa-heartbeat"></i> System Health</a>
                <a href="/api/files" class="btn-test"><i class="fas fa-code"></i> Files JSON API</a>
                <a href="/config" class="btn-test"><i class="fas fa-cog"></i> Configuration</a>
                <button id="refreshModelsBtn" class="btn-test"><i class="fas fa-redo"></i> Refresh Models</button>
                <button id="reindexBtn" class="btn-test"><i class="fas fa-sync-alt"></i> Reindex Documents</button>
            </div>
        </div>

        <!-- System Resources -->
        <div class="system-status-box">
            <div class="status-header">
                <i class="fas fa-tachometer-alt"></i> System Resources
            </div>
            
            <div class="status-item">
                <span class="status-label">Memory Usage:</span>
                <span class="status-value" id="memoryText">Loading...</span>
            </div>
            
            <div class="memory-visualization">
                <div class="memory-used" id="memoryBar"></div>
                <div class="memory-label" id="memoryLabel"></div>
            </div>
            
            <div class="status-item">
                <span class="status-label">CPU Usage:</span>
                <span class="status-value" id="cpuText">Loading...</span>
            </div>
            
            <div class="status-item">
                <span class="status-label">Disk Usage:</span>
                <span class="status-value" id="diskText">Loading...</span>
            </div>
            
            <div class="status-item">
                <span class="status-label">Active Tasks:</span>
                <span class="status-value" id="tasksText">0</span>
            </div>
            
            <div class="quick-actions">
                <button id="refreshResourcesBtn" class="btn-quick">
                    <i class="fas fa-redo"></i> Refresh Resources
                </button>
                <button id="viewDetailedBtn" class="btn-quick">
                    <i class="fas fa-chart-bar"></i> Detailed Metrics
                </button>
                <button id="viewTasksBtn" class="btn-quick">
                    <i class="fas fa-tasks"></i> View Active Tasks
                </button>
            </div>
        </div>
    </div>

    <!-- Loading overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div id="loadingText" style="margin-top: 20px; font-weight: bold; font-size: 1.1rem;"></div>
    </div>

    <!-- Progress overlay (for task monitoring) -->
    <div class="loading-overlay" id="progressOverlay">
        <div class="progress-overlay">
            <div class="loading-spinner"></div>
            <h3 id="progressTitle">Processing...</h3>
            <div class="progress-message" id="progressMessage">Starting task...</div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="progress-percent" id="progressPercent">0%</div>
            <div class="task-logs" id="taskLogs"></div>
            <button id="cancelTaskBtn" class="btn-quick" style="margin-top: 20px;">
                <i class="fas fa-times"></i> Cancel Task
            </button>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="/static/js/dashboard.js"></script>
</body>
</html>