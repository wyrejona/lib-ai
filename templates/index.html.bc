{% extends "base.html" %}

{% block title %}Dashboard - Library Support AI{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/index.css">
<link rel="stylesheet" href="/static/css/model-manager.css">
{% endblock %}

{% block content %}
<div class="container">
    <header>
        <div class="logo">
            <i class="fas fa-brain"></i>
            <h1>Library Support AI</h1>
        </div>
        
        <div class="nav-links">
            <a href="/" class="nav-link {% if request.url.path == '/' %}active{% endif %}">
                <i class="fas fa-home"></i> Home
            </a>
            <a href="/files" class="nav-link {% if request.url.path == '/files' %}active{% endif %}">
                <i class="fas fa-folder"></i> Manage Files
            </a>
            <a href="/chat" class="nav-link {% if request.url.path == '/chat' %}active{% endif %}">
                <i class="fas fa-comments"></i> Chat
            </a>
        </div>
    </header>

    <section class="welcome-section">
        <h2>Welcome!</h2>
        <p>System Reliability Dashboard for Library Research AI</p>
        <p><small>Manage your AI models and system resources from this dashboard.</small></p>
    </section>

    <div class="grid-menu">
        <a href="/chat" class="menu-card">
            <i class="fas fa-comments"></i>
            <h3>AI Chat Interface</h3>
            <p>Query your uploaded research papers using natural language.</p>
            <span style="color: var(--primary); font-weight: bold;">Open Chat →</span>
        </a>

        <a href="/files" class="menu-card">
            <i class="fas fa-folder"></i>
            <h3>Manage Documents</h3>
            <p>Upload, view, and manage your PDF documents.</p>
            <span style="color: var(--primary); font-weight: bold;">Manage Files →</span>
        </a>
        
        <div class="menu-card system-status-card">
            <i class="fas fa-server"></i>
            <h3>System Status</h3>
            <div class="system-metrics">
                <div class="metric">
                    <span class="metric-label">RAM Available:</span>
                    <span id="quickRam" class="metric-value">Loading...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Current Model:</span>
                    <span id="quickModel" class="metric-value">Loading...</span>
                </div>
            </div>
            <span style="color: var(--primary); font-weight: bold;">View Details →</span>
        </div>
    </div>

    <!-- System Status Section -->
    <section class="status-section">
        <h2>System Status</h2>
        <div class="status-grid">
            <!-- AI Engine Status -->
            <div class="status-card">
                <h3><i class="fas fa-microchip"></i> AI Engine Status</h3>
                <div class="status-item">
                    <span class="status-label">Chat Model:</span>
                    <span id="currentChatModel" class="status-value">Loading...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Embedding Model:</span>
                    <span id="currentEmbeddingModel" class="status-value">Loading...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Vector Store:</span>
                    <span id="vectorStoreStatus" class="status-value">Loading...</span>
                    <small id="vectorStoreTime" class="timestamp"></small>
                </div>
                <div class="status-item">
                    <span class="status-label">Ollama Connection:</span>
                    <span id="ollamaStatus" class="status-value">Loading...</span>
                    <small id="ollamaTime" class="timestamp"></small>
                </div>
            </div>

            <!-- System Resources -->
            <div class="status-card">
                <h3><i class="fas fa-server"></i> System Resources</h3>
                <div class="status-item">
                    <span class="status-label">Memory Usage:</span>
                    <div class="progress-bar">
                        <div id="memoryProgress" class="progress-fill" style="width: 0%"></div>
                    </div>
                    <span id="memoryPercent" class="status-value">0%</span>
                </div>
                <div class="status-item">
                    <span>Available: <span id="memoryAvailable">0 GB</span> | Total: <span id="memoryTotal">0 GB</span></span>
                </div>
                
                <div class="status-item">
                    <span class="status-label">CPU Usage:</span>
                    <div class="progress-bar">
                        <div id="cpuProgress" class="progress-fill" style="width: 0%"></div>
                    </div>
                    <span id="cpuPercent" class="status-value">0%</span>
                </div>
                <div class="status-item">
                    <span id="cpuCores">Cores: 0</span> | <span id="cpuLoad">Load: 0.00</span>
                </div>
                
                <div class="status-item">
                    <span class="status-label">Disk Usage:</span>
                    <div class="progress-bar">
                        <div id="diskProgress" class="progress-fill" style="width: 0%"></div>
                    </div>
                    <span id="diskPercent" class="status-value">0%</span>
                </div>
                <div class="status-item">
                    <span>Free: <span id="diskFree">0 GB</span> | Total: <span id="diskTotal">0 GB</span></span>
                </div>
            </div>
        </div>
    </section>

    <!-- Model Management Section -->
    <section class="model-management-section">
        <h2><i class="fas fa-cubes"></i> Model Management</h2>
        
        <!-- Current Models -->
        <div class="current-models">
            <div class="current-model-card">
                <h3><i class="fas fa-robot"></i> Active Chat Model</h3>
                <div class="model-info">
                    <span id="activeChatModelName" class="model-name">Loading...</span>
                    <span id="activeChatModelSize" class="model-size">Size: Loading...</span>
                    <span id="activeChatModelRAM" class="model-ram">RAM: Loading...</span>
                </div>
                <button id="changeChatBtn" class="btn btn-primary" onclick="ModelManager.showChatModels()">
                    <i class="fas fa-exchange-alt"></i> Change Model
                </button>
            </div>
            
            <div class="current-model-card">
                <h3><i class="fas fa-project-diagram"></i> Active Embedding Model</h3>
                <div class="model-info">
                    <span id="activeEmbeddingModelName" class="model-name">Loading...</span>
                    <span id="activeEmbeddingModelSize" class="model-size">Size: Loading...</span>
                    <span id="activeEmbeddingModelRAM" class="model-ram">RAM: Loading...</span>
                </div>
                <button id="changeEmbeddingBtn" class="btn btn-primary" onclick="ModelManager.showEmbeddingModels()">
                    <i class="fas fa-exchange-alt"></i> Change Model
                </button>
            </div>
        </div>

        <!-- Model Recommendations -->
        <div class="recommendations-card">
            <h3><i class="fas fa-lightbulb"></i> Recommendations</h3>
            <div id="recommendationsList">
                <p>Analyzing your system...</p>
            </div>
        </div>

        <!-- Model Browser -->
        <div class="model-browser">
            <div class="browser-header">
                <h3><i class="fas fa-search"></i> Model Browser</h3>
                <div class="browser-tabs">
                    <button class="tab-btn active" onclick="ModelManager.showTab('chat')">Chat Models</button>
                    <button class="tab-btn" onclick="ModelManager.showTab('embedding')">Embedding Models</button>
                    <button class="tab-btn" onclick="ModelManager.showTab('installed')">Installed Models</button>
                </div>
            </div>
            
            <div class="browser-content">
                <!-- Chat Models Tab -->
                <div id="chatModelsTab" class="model-tab active">
                    <div class="model-list">
                        <!-- Models will be loaded here -->
                        <p>Loading chat models...</p>
                    </div>
                </div>
                
                <!-- Embedding Models Tab -->
                <div id="embeddingModelsTab" class="model-tab">
                    <div class="model-list">
                        <!-- Models will be loaded here -->
                        <p>Loading embedding models...</p>
                    </div>
                </div>
                
                <!-- Installed Models Tab -->
                <div id="installedModelsTab" class="model-tab">
                    <div class="model-list">
                        <!-- Models will be loaded here -->
                        <p>Loading installed models...</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Model Installation Modal -->
    <div id="installModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-download"></i> Install Model</h3>
                <button class="modal-close" onclick="ModelManager.closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="installModelInfo">
                    <h4 id="installModelName">Model Name</h4>
                    <div class="install-details">
                        <p><strong>Type:</strong> <span id="installModelType">Chat</span></p>
                        <p><strong>Estimated Size:</strong> <span id="installModelSize">Unknown</span></p>
                        <p><strong>Required RAM:</strong> <span id="installModelRAM">Unknown</span></p>
                        <p><strong>Disk Space Needed:</strong> <span id="installModelDisk">Unknown</span></p>
                        <p><strong>Your Available RAM:</strong> <span id="installAvailableRAM">Loading...</span></p>
                        <p><strong>Your Available Disk:</strong> <span id="installAvailableDisk">Loading...</span></p>
                    </div>
                    <div id="installCompatibility" class="compatibility-check"></div>
                </div>
                <div id="installProgress" style="display: none;">
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div id="installProgressBar" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <span id="installProgressText">0%</span>
                    </div>
                    <p id="installStatus">Starting download...</p>
                    <div id="installLog" class="install-log"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="installCancelBtn" class="btn btn-secondary" onclick="ModelManager.closeModal()">Cancel</button>
                <button id="installConfirmBtn" class="btn btn-primary" onclick="ModelManager.confirmInstall()">Install Now</button>
            </div>
        </div>
    </div>
</div>

<!-- Include the dashboard JavaScript -->
<script src="/static/js/index.js"></script>
<script src="/static/js/model-manager.js"></script>

<!-- Notification Container -->
<div id="notification-container"></div>
{% endblock %}
